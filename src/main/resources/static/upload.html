<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>文件上传 - 文件上传系统</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: white;
            font-size: 32px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .header p {
            color: rgba(255, 255, 255, 0.8);
            font-size: 16px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        .upload-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            padding: 40px;
            margin-bottom: 30px;
            transition: transform 0.3s ease;
        }

        .upload-card:hover {
            transform: translateY(-5px);
        }

        .upload-area {
            border: 3px dashed #d1d5db;
            border-radius: 16px;
            padding: 60px 20px;
            text-align: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            position: relative;
            overflow: hidden;
            background: linear-gradient(145deg, #f8f9fa, #ffffff);
        }
        
        .upload-area::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(102, 126, 234, 0.1), transparent);
            transition: left 0.5s;
        }

        .upload-area.dragover {
            border-color: #667eea;
            background: linear-gradient(145deg, #f0f4ff, #ffffff);
            transform: scale(1.02);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.15);
        }
        
        .upload-area:hover::before {
            left: 100%;
        }

        .upload-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 36px;
            transition: all 0.3s ease;
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }
        
        .upload-area:hover .upload-icon {
            transform: scale(1.1) rotate(5deg);
            box-shadow: 0 12px 30px rgba(102, 126, 234, 0.4);
        }

        .upload-text {
            color: #1f2937;
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 15px;
            letter-spacing: -0.3px;
        }

        .upload-hint {
            color: #6b7280;
            font-size: 15px;
            font-weight: 400;
            line-height: 1.4;
            margin-bottom: 20px;
        }

        .file-input {
            display: none;
        }

        .select-btn {
            background: linear-gradient(135deg, #6b7280, #4b5563);
            color: white;
            border: none;
            padding: 14px 35px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 12px rgba(107, 114, 128, 0.2);
            position: relative;
            overflow: hidden;
        }
        
        .select-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .select-btn:hover {
            background: linear-gradient(135deg, #4b5563, #374151);
            transform: translateY(-2px);
            box-shadow: 0 6px 18px rgba(107, 114, 128, 0.25);
        }
        
        .select-btn:hover::before {
            left: 100%;
        }
        
        .select-btn:active {
            transform: translateY(-1px);
        }

        .file-list {
            margin-top: 30px;
        }

        .file-item {
            background: linear-gradient(145deg, #ffffff, #f8f9fa);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid #e5e7eb;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
        }

        .file-item:hover {
            background: #e9ecef;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            border-color: #d1d5db;
        }

        .file-info {
            display: flex;
            align-items: center;
            flex: 1;
        }

        .file-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 16px;
            margin-right: 15px;
        }

        .file-details {
            flex: 1;
        }

        .file-name {
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 8px;
            font-size: 16px;
            letter-spacing: -0.2px;
        }

        .file-size {
            color: #6b7280;
            font-size: 14px;
            font-weight: 500;
        }

        .file-actions {
            display: flex;
            gap: 10px;
        }

        .remove-btn {
            background: linear-gradient(135deg, #9ca3af, #6b7280);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 12px rgba(156, 163, 175, 0.2);
        }

        .remove-btn:hover {
            background: linear-gradient(135deg, #6b7280, #4b5563);
            transform: translateY(-2px);
            box-shadow: 0 6px 18px rgba(156, 163, 175, 0.25);
        }
        
        .remove-btn:active {
            transform: translateY(0);
        }

        .upload-actions {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .upload-btn {
            background: linear-gradient(135deg, #6b7280, #4b5563);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
            position: relative;
            overflow: hidden;
        }

        .cancel-upload-btn {
            background: linear-gradient(135deg, #9ca3af, #6b7280);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
            position: relative;
            overflow: hidden;
        }

        .cancel-upload-btn:hover {
            background: linear-gradient(135deg, #6b7280, #4b5563);
            transform: translateY(-2px);
            box-shadow: 0 6px 18px rgba(156, 163, 175, 0.25);
        }

        .cancel-upload-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .cancel-upload-btn:hover::before {
            left: 100%;
        }

        .upload-btn:hover {
            background: linear-gradient(135deg, #4b5563, #374151);
            transform: translateY(-2px);
            box-shadow: 0 6px 18px rgba(107, 114, 128, 0.25);
        }

        .upload-btn:disabled {
            background: linear-gradient(135deg, #9ca3af, #6b7280);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .upload-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }
        
        .upload-btn:hover::before {
            left: 100%;
        }
        
        .upload-btn:disabled::before {
            display: none;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e5e7eb;
            border-radius: 20px;
            overflow: hidden;
            margin: 25px 0;
            display: none;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2, #10b981);
            width: 0%;
            transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 20px;
            position: relative;
            overflow: hidden;
        }
        
        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .status-message {
            text-align: center;
            margin-top: 20px;
            padding: 20px 25px;
            border-radius: 16px;
            font-weight: 600;
            display: none;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .status-success {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(5, 150, 105, 0.1));
            color: #047857;
            border: 1px solid rgba(16, 185, 129, 0.3);
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.15);
        }
        
        .status-success::before {
            content: '✓';
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 20px;
            font-weight: bold;
        }

        .status-error {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(220, 38, 38, 0.1));
            color: #b91c1c;
            border: 1px solid rgba(239, 68, 68, 0.3);
            box-shadow: 0 8px 25px rgba(239, 68, 68, 0.15);
        }
        
        .status-error::before {
            content: '✕';
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 20px;
            font-weight: bold;
        }

        .back-btn {
            position: fixed;
            top: 30px;
            left: 30px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .upload-card {
            animation: fadeIn 0.6s ease-out;
        }

        .server-files-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
            padding: 0;
            margin-bottom: 30px;
            transition: all 0.3s ease;
            animation: fadeIn 0.6s ease-out 0.2s both;
            overflow: hidden;
        }

        .server-files-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.2);
        }

        .server-files-header {
            background: linear-gradient(135deg, #f8f9fa, #ffffff);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 30px 40px;
            margin: 0;
            border-bottom: 1px solid #e5e7eb;
        }

        .server-files-title {
            color: #1f2937;
            font-size: 28px;
            font-weight: 700;
            margin: 0;
            letter-spacing: -0.5px;
        }

        .refresh-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 6px 15px rgba(102, 126, 234, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .refresh-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .refresh-btn:hover {
            background: linear-gradient(135deg, #5a6fd8, #6b46c1);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }
        
        .refresh-btn:hover::before {
            left: 100%;
        }

        .server-files-content {
            padding: 40px;
        }
        
        .server-file-item {
            background: linear-gradient(145deg, #ffffff, #f8f9fa);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid #e5e7eb;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
            position: relative;
            overflow: hidden;
        }
        
        .server-file-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(102, 126, 234, 0.05), transparent);
            transition: left 0.5s;
        }

        .server-file-item:hover {
            background: linear-gradient(145deg, #f8f9fa, #ffffff);
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.1);
            border-color: #d1d5db;
        }
        
        .server-file-item:hover::before {
            left: 100%;
        }

        .server-file-actions {
            display: flex;
            gap: 12px;
            align-items: center;
            padding: 8px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }
        
        .server-file-actions:hover {
            background: rgba(255, 255, 255, 0.7);
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
        }

        .delete-btn {
            background: linear-gradient(135deg, #9ca3af, #6b7280);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 12px rgba(156, 163, 175, 0.2);
            position: relative;
            overflow: hidden;
            min-width: 80px;
        }
        
        .delete-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.15), transparent);
            transition: left 0.5s;
        }

        .delete-btn:hover {
            background: linear-gradient(135deg, #6b7280, #4b5563);
            transform: translateY(-2px);
            box-shadow: 0 6px 18px rgba(156, 163, 175, 0.25);
        }
        
        .delete-btn:hover::before {
            left: 100%;
        }
        
        .delete-btn:active {
            transform: translateY(0);
            transition: all 0.1s ease;
        }

        .delete-btn:disabled {
            background: linear-gradient(135deg, #e5e7eb, #d1d5db);
            color: #9ca3af;
            cursor: not-allowed;
            transform: none;
            box-shadow: 0 2px 6px rgba(156, 163, 175, 0.15);
        }
        
        .delete-btn:disabled::before {
            display: none;
        }

        .download-btn {
            background: linear-gradient(135deg, #6b7280, #4b5563);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 12px rgba(107, 114, 128, 0.2);
            position: relative;
            overflow: hidden;
            min-width: 80px;
        }
        
        .download-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.15), transparent);
            transition: left 0.5s;
        }

        .download-btn:hover {
            background: linear-gradient(135deg, #4b5563, #374151);
            transform: translateY(-2px);
            box-shadow: 0 6px 18px rgba(107, 114, 128, 0.25);
        }
        
        .download-btn:hover::before {
            left: 100%;
        }
        
        .download-btn:active {
            transform: translateY(0);
            transition: all 0.1s ease;
        }

        .download-btn:disabled {
            background: linear-gradient(135deg, #e5e7eb, #d1d5db);
            color: #9ca3af;
            cursor: not-allowed;
            transform: none;
            box-shadow: 0 2px 6px rgba(156, 163, 175, 0.15);
        }
        
        .download-btn:disabled::before {
            display: none;
        }

        .server-file-info {
            display: flex;
            align-items: center;
            flex: 1;
            gap: 15px;
        }

        .server-file-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            flex-shrink: 0;
        }

        .server-file-details {
            flex: 1;
        }

        .server-file-name {
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 8px;
            font-size: 18px;
            letter-spacing: -0.3px;
            word-break: break-all;
        }

        .server-file-meta {
            color: #6b7280;
            font-size: 14px;
            font-weight: 500;
            display: flex;
            gap: 25px;
        }
        
        .file-detail-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .file-detail-item::before {
            content: '';
            width: 4px;
            height: 4px;
            background: #9ca3af;
            border-radius: 50%;
        }

        .loading-message {
            text-align: center;
            color: #6b7280;
            font-style: italic;
            padding: 40px 20px;
        }

        .empty-message {
            text-align: center;
            color: #6b7280;
            padding: 40px 20px;
        }

        .empty-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .error-message {
            text-align: center;
            color: #ef4444;
            padding: 40px 20px;
            background: #fee2e2;
            border-radius: 12px;
            border: 1px solid #fca5a5;
        }

        .file-count {
            color: #6b7280;
            font-size: 14px;
            margin-top: 20px;
            text-align: center;
        }
        
        /* 自定义删除确认模态框 */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }
        
        .modal {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 450px;
            width: 90%;
            text-align: center;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
            transform: scale(0.8) translateY(20px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .modal-overlay.show .modal {
            transform: scale(1) translateY(0);
        }
        
        .modal-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #ef4444, #dc2626);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 25px;
            font-size: 36px;
            color: white;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .modal-title {
            font-size: 24px;
            font-weight: 700;
            color: #374151;
            margin-bottom: 15px;
        }
        
        .modal-message {
            font-size: 16px;
            color: #6b7280;
            margin-bottom: 30px;
            line-height: 1.5;
        }
        
        .modal-filename {
            background: #f3f4f6;
            padding: 12px 16px;
            border-radius: 10px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 14px;
            color: #374151;
            margin: 15px 0;
            word-break: break-all;
            border-left: 4px solid #ef4444;
        }
        
        .modal-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        
        .modal-btn {
            padding: 12px 30px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 120px;
        }
        
        .modal-btn-cancel {
            background: #f3f4f6;
            color: #6b7280;
        }
        
        .modal-btn-cancel:hover {
            background: #e5e7eb;
            color: #374151;
            transform: translateY(-2px);
        }
        
        .modal-btn-delete {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }
        
        .modal-btn-delete:hover {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(239, 68, 68, 0.3);
        }
        
        .modal-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }




        /* 部署功能样式 */
        .deploy-card {
            background: linear-gradient(135deg, #ffffff, #f8fafc);
            border-radius: 20px;
            padding: 30px;
            margin-top: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            border: 1px solid #e2e8f0;
            transition: all 0.3s ease;
        }

        .deploy-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
        }

        .deploy-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .deploy-title {
            font-size: 28px;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 0 0 10px 0;
        }

        .deploy-hint {
            color: #64748b;
            font-size: 16px;
            margin: 0;
        }

        .deploy-content {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .deploy-input-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .deploy-label {
            font-weight: 600;
            color: #374151;
            font-size: 14px;
        }

        .deploy-input {
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: #ffffff;
        }

        .deploy-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            transform: translateY(-2px);
        }

        .deploy-actions {
            display: flex;
            gap: 15px;
            margin-top: 10px;
        }

        .deploy-output {
            background: #1f2937;
            color: #f9fafb;
            border-radius: 12px;
            padding: 20px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 14px;
            line-height: 1.6;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
            border: 1px solid #374151;
            display: none;
        }

        .deploy-output.show {
            display: block;
            animation: slideIn 0.3s ease-out;
        }

        .deploy-output::-webkit-scrollbar {
            width: 8px;
        }

        .deploy-output::-webkit-scrollbar-track {
            background: #374151;
            border-radius: 4px;
        }

        .deploy-output::-webkit-scrollbar-thumb {
            background: #6b7280;
            border-radius: 4px;
        }

        .deploy-output::-webkit-scrollbar-thumb:hover {
            background: #9ca3af;
        }
        
        /* 部署按钮样式 */
        .execute-btn {
            background: linear-gradient(135deg, #64748b, #475569);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 12px rgba(100, 116, 139, 0.2);
            position: relative;
            overflow: hidden;
            flex: 1;
        }
        
        .execute-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.15), transparent);
            transition: left 0.5s;
        }
        
        .execute-btn:hover {
            background: linear-gradient(135deg, #475569, #334155);
            transform: translateY(-2px);
            box-shadow: 0 6px 18px rgba(100, 116, 139, 0.25);
        }
        
        .execute-btn:hover::before {
            left: 100%;
        }
        
        .execute-btn:active {
            transform: translateY(0);
            transition: all 0.1s ease;
        }
        
        .execute-btn:disabled {
            background: linear-gradient(135deg, #e2e8f0, #cbd5e1);
            color: #94a3b8;
            cursor: not-allowed;
            transform: none;
            box-shadow: 0 2px 6px rgba(148, 163, 184, 0.15);
        }
        
        .execute-btn:disabled::before {
            display: none;
        }
        
        /* 清空日志按钮样式 */
        .clear-btn {
            background: linear-gradient(135deg, #94a3b8, #64748b);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 12px rgba(148, 163, 184, 0.2);
            position: relative;
            overflow: hidden;
            flex: 1;
        }
        
        .clear-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.15), transparent);
            transition: left 0.5s;
        }
        
        .clear-btn:hover {
            background: linear-gradient(135deg, #64748b, #475569);
            transform: translateY(-2px);
            box-shadow: 0 6px 18px rgba(148, 163, 184, 0.25);
        }
        
        .clear-btn:hover::before {
            left: 100%;
        }
        
        .clear-btn:active {
            transform: translateY(0);
            transition: all 0.1s ease;
        }

        /* 导航菜单样式 */
        .nav-menu {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }

        .nav-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .nav-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.5);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .nav-btn.active {
            background: rgba(255, 255, 255, 0.9);
            color: #667eea;
            border-color: white;
        }

        /* 内容区域样式 */
        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        /* 快捷菜单按钮样式 */
        .quick-menu-section {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .quick-menu-header {
            margin-bottom: 20px;
        }
        
        .quick-menu-title {
            font-size: 18px;
            font-weight: 600;
            color: #374151;
            margin: 0 0 8px 0;
        }
        
        .quick-menu-hint {
            font-size: 14px;
            color: #6b7280;
            margin: 0;
        }
        
        .quick-menu-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }
        
        .quick-deploy-btn {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.2);
            position: relative;
            overflow: hidden;
            min-width: 120px;
        }
        
        .quick-deploy-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.15), transparent);
            transition: left 0.5s;
        }
        
        .quick-deploy-btn:hover {
            background: linear-gradient(135deg, #059669, #047857);
            transform: translateY(-2px);
            box-shadow: 0 6px 18px rgba(16, 185, 129, 0.25);
        }
        
        .quick-deploy-btn:hover::before {
            left: 100%;
        }
        
        .quick-deploy-btn:active {
            transform: translateY(0);
            transition: all 0.1s ease;
        }
        
        .quick-menu-empty {
            text-align: center;
            padding: 30px;
            color: #9ca3af;
            font-size: 14px;
        }
        
        .quick-menu-empty-icon {
            font-size: 32px;
            margin-bottom: 12px;
        }

        /* 菜单配置样式 */
        .menu-config-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            padding: 40px;
            margin-bottom: 30px;
        }

        .menu-config-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e5e7eb;
        }

        .menu-config-title {
            color: #1f2937;
            font-size: 24px;
            font-weight: 700;
            margin: 0;
        }

        .add-menu-btn {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        .add-menu-btn:hover {
            background: linear-gradient(135deg, #059669, #047857);
            transform: translateY(-2px);
            box-shadow: 0 6px 18px rgba(16, 185, 129, 0.4);
        }

        .menu-item {
            background: linear-gradient(145deg, #ffffff, #f8f9fa);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
            border: 1px solid #e5e7eb;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
            transition: all 0.3s ease;
        }

        .menu-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .menu-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .menu-item-name {
            font-size: 18px;
            font-weight: 600;
            color: #1f2937;
        }

        .menu-item-actions {
            display: flex;
            gap: 10px;
        }

        .edit-btn, .delete-btn, .deploy-menu-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .edit-btn {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
        }

        .edit-btn:hover {
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
            transform: translateY(-1px);
        }

        .delete-btn {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }

        .delete-btn:hover {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            transform: translateY(-1px);
        }

        .deploy-menu-btn {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: white;
        }

        .deploy-menu-btn:hover {
            background: linear-gradient(135deg, #7c3aed, #6d28d9);
            transform: translateY(-1px);
        }

        .menu-item-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            color: #6b7280;
            font-size: 14px;
        }

        .menu-detail-item {
            display: flex;
            flex-direction: column;
        }

        .menu-detail-label {
            font-weight: 600;
            color: #374151;
            margin-bottom: 4px;
        }

        .menu-detail-value {
            word-break: break-all;
        }

        /* 菜单配置表单样式 */
        .menu-form {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 24px;
            margin-top: 20px;
            border: 2px solid #e5e7eb;
        }

        .menu-form.show {
            display: block;
        }

        .menu-form.hide {
            display: none;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            color: #374151;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #d1d5db;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: white;
        }

        .form-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        .save-btn, .cancel-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .save-btn {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }

        .save-btn:hover {
            background: linear-gradient(135deg, #059669, #047857);
            transform: translateY(-1px);
        }

        .cancel-btn {
            background: linear-gradient(135deg, #6b7280, #4b5563);
            color: white;
        }

        .cancel-btn:hover {
            background: linear-gradient(135deg, #4b5563, #374151);
            transform: translateY(-1px);
        }
    </style>
</head>
<body>
    <button class="back-btn" onclick="logout()">🚪 注销</button>
    
    <div class="header">
        <h1>文件上传</h1>
        <p>选择文件并上传到服务器</p>
        <div class="nav-menu">
            <button class="nav-btn" onclick="showSection('upload')">📁 文件上传</button>
            <button class="nav-btn" onclick="showSection('deploy')">🚀 自动部署</button>
            <button class="nav-btn" onclick="showSection('menu-config')">⚙️ 菜单管理</button>
        </div>
    </div>

    <div class="container">
        <!-- 文件上传区域 -->
        <div id="upload-section" class="content-section active">
            <div class="upload-card">
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">📁</div>
                <div class="upload-text">拖拽文件到此处</div>
                <div class="upload-hint">或者点击下方按钮选择文件</div>
                <button class="select-btn" onclick="document.getElementById('fileInput').click()">选择文件</button>
                <input type="file" id="fileInput" class="file-input" multiple>
            </div>

            <div class="file-list" id="fileList"></div>

            <div class="upload-actions">
                <button class="upload-btn" id="uploadBtn" onclick="uploadFiles()" disabled>
                    上传文件
                </button>
                <button class="cancel-upload-btn" id="cancelBtn" onclick="cancelUpload()" style="display: none;">
                    取消上传
                </button>
            </div>

            <div class="progress-bar" id="progressBar">
                <div class="progress-fill" id="progressFill"></div>
            </div>

            <div class="status-message" id="statusMessage"></div>
        </div>

        <div class="server-files-card">
            <div class="server-files-header">
                <h2 class="server-files-title">服务器文件列表</h2>
                <button class="refresh-btn" onclick="loadServerFiles()">🔄 刷新</button>
            </div>
            <div id="serverFilesList" class="server-files-content">
                <div class="loading-message">正在加载文件列表...</div>
            </div>
        </div>
        </div>

        <!-- 自动部署区域 -->
        <div id="deploy-section" class="content-section">
            <div class="deploy-card">
            <div class="deploy-header">
                <h2 class="deploy-title">自动部署</h2>
                <div class="deploy-hint">搜索并上传文件，然后执行部署脚本</div>
            </div>
            
            <!-- 快捷菜单按钮区域 -->
            <div class="quick-menu-section" id="quickMenuSection">
                <div class="quick-menu-header">
                    <h3 class="quick-menu-title">快捷部署菜单</h3>
                    <div class="quick-menu-hint">点击按钮快速执行预配置的部署任务</div>
                </div>
                <div class="quick-menu-buttons" id="quickMenuButtons">
                    <!-- 动态生成的菜单按钮将显示在这里 -->
                </div>
            </div>
            
            <div class="deploy-content">
                <div class="deploy-input-group">
                    <label for="sourceDir" class="deploy-label">源目录:</label>
                    <input type="text" id="sourceDir" class="deploy-input" placeholder="例如: C:\\Users\\17702\\Downloads" value="C:\\Users\\17702\\Downloads" />
                </div>
                <div class="deploy-input-group">
                    <label for="frontendPattern" class="deploy-label">匹配前端文件名:</label>
                    <input type="text" id="frontendPattern" class="deploy-input" placeholder="例如: zhpj-web*.zip" value="zhpj-web*.zip" />
                </div>
                <div class="deploy-input-group">
                    <label for="backendPattern" class="deploy-label">匹配后端文件名:</label>
                    <input type="text" id="backendPattern" class="deploy-input" placeholder="例如: zhpj_api*.zip" value="zhpj_api*.zip" />
                </div>
                <div class="deploy-input-group">
                    <label for="deployScript" class="deploy-label">部署脚本:</label>
                    <input type="text" id="deployScript" class="deploy-input" placeholder="例如: deploy.bat" value="deploy.bat" />
                </div>
                <div class="deploy-actions">
                    <button class="execute-btn" onclick="startDeploy()" id="deployBtn">
                        🚀 开始部署
                    </button>
                    <button class="clear-btn" onclick="clearDeployOutput()">
                        🗑️ 清空日志
                    </button>
                </div>
                <div class="deploy-output" id="deployOutput"></div>
            </div>
        </div>
        </div>

        <!-- 菜单管理区域 -->
        <div id="menu-config-section" class="content-section">
            <div class="menu-config-card">
                <div class="menu-config-header">
                    <h2 class="menu-config-title">菜单管理</h2>
                    <button class="add-menu-btn" onclick="showAddMenuForm()">➕ 添加菜单</button>
                </div>
                
                <!-- 添加/编辑菜单表单 -->
                <div id="menuForm" class="menu-form hide">
                    <div class="form-group">
                        <label class="form-label">按钮名称</label>
                        <input type="text" id="menuName" class="form-input" placeholder="例如: 一键部署智慧评价">
                    </div>
                    <div class="form-group">
                        <label class="form-label">源目录</label>
                        <input type="text" id="menuSourceDir" class="form-input" placeholder="例如: C:\\Users\\17702\\Downloads">
                    </div>
                    <div class="form-group">
                        <label class="form-label">匹配前端文件名</label>
                        <input type="text" id="menuFrontendPattern" class="form-input" placeholder="例如: zhpj-web*.zip">
                    </div>
                    <div class="form-group">
                        <label class="form-label">匹配后端文件名</label>
                        <input type="text" id="menuBackendPattern" class="form-input" placeholder="例如: zhpj_api*.zip">
                    </div>
                    <div class="form-group">
                        <label class="form-label">部署脚本路径</label>
                        <input type="text" id="menuDeployScript" class="form-input" placeholder="例如: /home/appuser/deploy.sh">
                    </div>
                    <div class="form-actions">
                        <button class="save-btn" onclick="saveMenu()">💾 保存</button>
                        <button class="cancel-btn" onclick="hideMenuForm()">❌ 取消</button>
                    </div>
                </div>
                
                <!-- 菜单列表 -->
                <div id="menuList" class="menu-list">
                    <!-- 菜单项将通过JavaScript动态生成 -->
                </div>
            </div>
        </div>
    </div>

    <!-- 自定义删除确认模态框 -->
    <div id="deleteModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-icon">🗑️</div>
            <div class="modal-title">确认删除文件</div>
            <div class="modal-message">
                您确定要删除以下文件吗？此操作不可撤销！
            </div>
            <div id="modalFilename" class="modal-filename"></div>
            <div class="modal-actions">
                <button id="modalCancel" class="modal-btn modal-btn-cancel">取消</button>
                <button id="modalConfirm" class="modal-btn modal-btn-delete">删除</button>
            </div>
        </div>
    </div>

    <script>
        let selectedFiles = [];
        
        // 会话管理
        let sessionId = null;
        let sessionTimer = null;
        const SESSION_TIMEOUT = 10 * 60 * 1000; // 10分钟
        
        // 初始化会话
        async function initSession(authSessionId) {
            try {
                const response = await fetch('/api/session/create', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        authSessionId: authSessionId
                    })
                });
                
                if (!response.ok) {
                    throw new Error('创建会话失败');
                }
                
                const result = await response.json();
                if (result.success) {
                    sessionId = result.sessionId;
                    startSessionTimer();
                    console.log('文件上传会话创建成功:', sessionId);
                    // 会话创建成功后加载文件列表
                    await loadServerFiles();
                } else {
                    // 如果会话创建失败，可能是认证会话过期，重定向到登录页面
                    console.error('创建会话失败:', result.message);
                    if (result.message && result.message.includes('认证会话')) {
                        alert('认证已过期，请重新登录');
                        localStorage.removeItem('fileupload_auth_session');
                        localStorage.removeItem('fileupload_auth_time');
                        window.location.href = 'index.html';
                        return;
                    }
                    throw new Error(result.message || '创建会话失败');
                }
            } catch (error) {
                console.error('初始化会话失败:', error);
                alert('会话初始化失败，请刷新页面重试');
            }
        }
        
        // 启动会话计时器
        function startSessionTimer() {
            if (sessionTimer) {
                clearTimeout(sessionTimer);
            }
            sessionTimer = setTimeout(() => {
                sessionExpired();
            }, SESSION_TIMEOUT);
        }
        
        // 重置会话计时器
        function resetSessionTimer() {
            if (sessionId) {
                startSessionTimer();
            }
        }
        
        // 会话过期处理
        function sessionExpired() {
            sessionId = null;
            if (sessionTimer) {
                clearTimeout(sessionTimer);
                sessionTimer = null;
            }
            alert('会话已过期，请重新登录');
            window.location.href = 'index.html';
        }
        
        // 统一处理会话过期
        function handleSessionExpired() {
            console.log('检测到会话过期，清理本地存储并跳转到登录页面');
            // 清理所有相关的本地存储
            localStorage.removeItem('fileupload_auth_session');
            localStorage.removeItem('fileupload_auth_time');
            localStorage.removeItem('fileupload_authenticated');
            localStorage.removeItem('menuConfigs');
            
            // 清理会话状态
            sessionId = null;
            if (sessionTimer) {
                clearTimeout(sessionTimer);
                sessionTimer = null;
            }
            
            // 显示提示并跳转
            alert('会话已过期，请重新登录');
            window.location.href = 'index.html';
        }
        
        // 检查会话有效性
        function isSessionValid() {
            return sessionId !== null;
        }
        
        // 检查访问权限
        function checkAccess() {
            const authSessionId = localStorage.getItem('fileupload_auth_session');
            const authTime = localStorage.getItem('fileupload_auth_time');
            
            // 检查是否有认证会话ID
            if (!authSessionId) {
                console.log('未找到认证会话，重定向到登录页面');
                window.location.href = 'index.html';
                return false;
            }
            
            // 检查认证是否过期（24小时）
            if (authTime) {
                const authTimestamp = parseInt(authTime);
                const currentTime = Date.now();
                const AUTH_TIMEOUT = 24 * 60 * 60 * 1000; // 24小时
                
                if (currentTime - authTimestamp > AUTH_TIMEOUT) {
                    console.log('认证会话已过期，清理本地存储');
                    localStorage.removeItem('fileupload_auth_session');
                    localStorage.removeItem('fileupload_auth_time');
                    localStorage.removeItem('fileupload_authenticated'); // 清理旧的认证标记
                    window.location.href = 'index.html';
                    return false;
                }
            }
            
            return authSessionId; // 返回认证会话ID
        }
        
        // 页面加载时检查访问权限并初始化会话
        window.addEventListener('load', function() {
            const authSessionId = checkAccess();
            if (authSessionId) {
                initSession(authSessionId);
            }
        });
        
        // 用户活动时重置计时器
        document.addEventListener('click', resetSessionTimer);
        document.addEventListener('keypress', resetSessionTimer);
        document.addEventListener('mousemove', resetSessionTimer);

        // 文件选择处理
        document.getElementById('fileInput').addEventListener('change', function(e) {
            handleFiles(e.target.files);
        });

        // 拖拽处理
        const uploadArea = document.getElementById('uploadArea');
        
        uploadArea.addEventListener('dragover', function(e) {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', function(e) {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', function(e) {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            handleFiles(e.dataTransfer.files);
        });

        function handleFiles(files) {
            for (let file of files) {
                if (!selectedFiles.find(f => f.name === file.name && f.size === file.size)) {
                    selectedFiles.push(file);
                }
            }
            updateFileList();
            updateUploadButton();
        }

        function updateFileList() {
            const fileList = document.getElementById('fileList');
            fileList.innerHTML = '';

            selectedFiles.forEach((file, index) => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.innerHTML = `
                    <div class="file-info">
                        <div class="file-icon">📄</div>
                        <div class="file-details">
                            <div class="file-name">${file.name}</div>
                            <div class="file-size">${formatFileSize(file.size)}</div>
                        </div>
                    </div>
                    <div class="file-actions">
                        <button class="remove-btn" onclick="removeFile(${index})">移除</button>
                    </div>
                `;
                fileList.appendChild(fileItem);
            });
        }

        function removeFile(index) {
            selectedFiles.splice(index, 1);
            updateFileList();
            updateUploadButton();
        }

        function updateUploadButton() {
            const uploadBtn = document.getElementById('uploadBtn');
            uploadBtn.disabled = selectedFiles.length === 0;
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // 存储上传会话信息（用于断点续传）
        const uploadSessions = new Map();
        let isUploading = false;
        let uploadAbortController = null;
        
        async function uploadFiles() {
            if (selectedFiles.length === 0) return;
            if (isUploading) return;

            const uploadBtn = document.getElementById('uploadBtn');
            const cancelBtn = document.getElementById('cancelBtn');
            const progressBar = document.getElementById('progressBar');
            const progressFill = document.getElementById('progressFill');
            const statusMessage = document.getElementById('statusMessage');

            isUploading = true;
            uploadAbortController = new AbortController();
            uploadBtn.disabled = true;
            uploadBtn.textContent = '上传中...';
            cancelBtn.style.display = 'block';
            progressBar.style.display = 'block';
            statusMessage.style.display = 'none';

            try {
                let totalProgress = 0;
                const fileCount = selectedFiles.length;
                let successCount = 0;
                let failedFiles = [];

                for (let i = 0; i < selectedFiles.length; i++) {
                    const file = selectedFiles[i];
                    
                    try {
                        // 更新状态显示当前上传的文件
                        uploadBtn.textContent = `上传中... (${i + 1}/${fileCount}) ${file.name}`;
                        
                        // 分片上传单个文件
                        const result = await uploadFileWithChunks(file, (fileProgress) => {
                            // 计算总体进度
                            const currentFileProgress = (i / fileCount) * 100 + (fileProgress / fileCount);
                            progressFill.style.width = currentFileProgress + '%';
                        });
                        
                        successCount++;
                        console.log(`文件上传成功: ${file.name}, MD5: ${result.md5}`);
                        
                    } catch (error) {
                        console.error(`文件上传失败: ${file.name}`, error);
                        failedFiles.push({ file: file, error: error.message });
                    }
                    
                    totalProgress = ((i + 1) / fileCount) * 100;
                    progressFill.style.width = totalProgress + '%';
                }

                // 显示上传结果
                if (failedFiles.length === 0) {
                    statusMessage.textContent = `成功上传 ${successCount} 个文件！`;
                    statusMessage.className = 'status-message status-success';
                    // 清空文件列表
                    selectedFiles = [];
                    updateFileList();
                } else {
                    const failedNames = failedFiles.map(f => f.file.name).join(', ');
                    statusMessage.textContent = `成功: ${successCount}个, 失败: ${failedFiles.length}个 (${failedNames})`;
                    statusMessage.className = 'status-message status-error';
                    
                    // 只保留失败的文件
                    selectedFiles = failedFiles.map(f => f.file);
                    updateFileList();
                }
                
                statusMessage.style.display = 'block';
                
                // 刷新服务器文件列表
                if (successCount > 0) {
                    loadServerFiles();
                }
                
            } catch (error) {
                console.error('上传错误:', error);
                statusMessage.textContent = '上传失败: ' + error.message;
                statusMessage.className = 'status-message status-error';
                statusMessage.style.display = 'block';
            } finally {
                isUploading = false;
                uploadAbortController = null;
                uploadBtn.disabled = false;
                uploadBtn.textContent = '上传文件';
                cancelBtn.style.display = 'none';
                progressBar.style.display = 'none';
                progressFill.style.width = '0%';
                updateUploadButton();
            }
        }
        
        // 分片上传单个文件（优化版本：支持重试、并发、断点续传）
        async function uploadFileWithChunks(file, progressCallback) {
            const CHUNK_SIZE = 2 * 1024 * 1024; // 2MB
            const totalChunks = Math.ceil(file.size / CHUNK_SIZE);
            const MAX_RETRIES = 3; // 最大重试次数
            const CONCURRENT_CHUNKS = 3; // 并发上传分片数
            
            // 检查会话有效性
            if (!isSessionValid()) {
                handleSessionExpired();
                return;
            }
            
            // 1. 初始化上传
            const initResponse = await fetch('/api/upload/init', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `fileName=${encodeURIComponent(file.name)}&fileSize=${file.size}&sessionId=${sessionId}`
            });
            
            if (!initResponse.ok) {
                throw new Error('初始化上传失败');
            }
            
            const initResult = await initResponse.json();
            if (!initResult.success) {
                throw new Error(initResult.message);
            }
            
            const uploadId = initResult.uploadId;
            
            // 2. 并发分片上传（带重试机制）
            const uploadedChunks = new Set();
            const failedChunks = new Map(); // 记录失败的分片和重试次数
            
            // 分片上传函数（带重试）
            const uploadChunk = async (chunkIndex, retryCount = 0) => {
                try {
                    const start = chunkIndex * CHUNK_SIZE;
                    const end = Math.min(start + CHUNK_SIZE, file.size);
                    const chunk = file.slice(start, end);
                    
                    const formData = new FormData();
                    formData.append('uploadId', uploadId);
                    formData.append('chunkIndex', chunkIndex);
                    formData.append('chunk', chunk);
                    formData.append('sessionId', sessionId);
                    
                    const chunkResponse = await fetch('/api/upload/chunk', {
                        method: 'POST',
                        body: formData,
                        signal: uploadAbortController?.signal
                    });
                    
                    if (!chunkResponse.ok) {
                        throw new Error(`HTTP ${chunkResponse.status}`);
                    }
                    
                    const chunkResult = await chunkResponse.json();
                    if (!chunkResult.success) {
                        throw new Error(chunkResult.message);
                    }
                    
                    uploadedChunks.add(chunkIndex);
                    failedChunks.delete(chunkIndex); // 成功后移除失败记录
                    
                    // 更新进度
                    const progress = (uploadedChunks.size / totalChunks) * 100;
                    if (progressCallback) {
                        progressCallback(progress);
                    }
                    
                    return true;
                    
                } catch (error) {
                    console.warn(`分片 ${chunkIndex} 上传失败 (第${retryCount + 1}次尝试):`, error.message);
                    
                    if (retryCount < MAX_RETRIES) {
                        // 指数退避重试
                        const delay = Math.min(1000 * Math.pow(2, retryCount), 5000);
                        await new Promise(resolve => setTimeout(resolve, delay));
                        return uploadChunk(chunkIndex, retryCount + 1);
                    } else {
                        failedChunks.set(chunkIndex, retryCount + 1);
                        throw new Error(`分片 ${chunkIndex + 1} 上传失败，已重试 ${MAX_RETRIES} 次`);
                    }
                }
            };
            
            // 并发上传所有分片
            const chunkPromises = [];
            for (let i = 0; i < totalChunks; i += CONCURRENT_CHUNKS) {
                const batch = [];
                for (let j = 0; j < CONCURRENT_CHUNKS && i + j < totalChunks; j++) {
                    batch.push(uploadChunk(i + j));
                }
                
                // 等待当前批次完成
                try {
                    await Promise.all(batch);
                } catch (error) {
                    // 如果批次中有失败的分片，记录但继续
                    console.warn('批次上传中有分片失败:', error.message);
                }
            }
            
            // 检查是否有失败的分片
            if (failedChunks.size > 0) {
                const failedList = Array.from(failedChunks.keys()).map(i => i + 1).join(', ');
                throw new Error(`以下分片上传失败: ${failedList}`);
            }
            
            // 3. 合并文件
            const mergeResponse = await fetch('/api/upload/merge', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `uploadId=${uploadId}&sessionId=${sessionId}`,
                signal: uploadAbortController?.signal
            });
            
            if (!mergeResponse.ok) {
                throw new Error('文件合并失败');
            }
            
            const mergeResult = await mergeResponse.json();
            if (!mergeResult.success) {
                throw new Error(mergeResult.message);
            }
            
            return mergeResult;
        }

        // 加载服务器文件列表
        async function loadServerFiles() {
            const serverFilesList = document.getElementById('serverFilesList');
            
            try {
                serverFilesList.innerHTML = '<div class="loading-message">正在加载文件列表...</div>';
                
                // 检查会话有效性
                if (!isSessionValid()) {
                    handleSessionExpired();
                    return;
                }
                
                const response = await fetch(`/api/files?sessionId=${sessionId}`);
                if (!response.ok) {
                    throw new Error('获取文件列表失败');
                }
                
                const result = await response.json();
                
                if (!result.success) {
                    throw new Error(result.message || '获取文件列表失败');
                }
                
                const files = result.files || [];
                
                if (files.length === 0) {
                    serverFilesList.innerHTML = `
                        <div class="empty-message">
                            <div class="empty-icon">📂</div>
                            <div>暂无文件</div>
                            <div style="font-size: 12px; margin-top: 8px;">上传目录: ${result.uploadPath || 'N/A'}</div>
                        </div>
                    `;
                    return;
                }
                
                // 根据文件扩展名选择图标
                const getFileIcon = (fileName) => {
                    const ext = fileName.split('.').pop().toLowerCase();
                    const iconMap = {
                        'pdf': '📄',
                        'doc': '📝', 'docx': '📝',
                        'xls': '📊', 'xlsx': '📊',
                        'ppt': '📈', 'pptx': '📈',
                        'txt': '📃',
                        'jpg': '🖼️', 'jpeg': '🖼️', 'png': '🖼️', 'gif': '🖼️', 'bmp': '🖼️',
                        'mp4': '🎬', 'avi': '🎬', 'mov': '🎬', 'wmv': '🎬',
                        'mp3': '🎵', 'wav': '🎵', 'flac': '🎵',
                        'zip': '📦', 'rar': '📦', '7z': '📦',
                        'exe': '⚙️', 'msi': '⚙️',
                        'html': '🌐', 'css': '🎨', 'js': '⚡', 'json': '📋'
                    };
                    return iconMap[ext] || '📄';
                };
                
                let html = '';
                 files.forEach(file => {
                     html += `
                         <div class="server-file-item">
                             <div class="server-file-info">
                                 <div class="server-file-icon">${getFileIcon(file.name)}</div>
                                 <div class="server-file-details">
                                     <div class="server-file-name">${escapeHtml(file.name)}</div>
                                     <div class="server-file-meta">
                                         <span class="file-detail-item">大小: ${file.sizeFormatted}</span>
                                         <span class="file-detail-item">修改时间: ${file.lastModifiedFormatted}</span>
                                     </div>
                                 </div>
                             </div>
                             <div class="server-file-actions">
                                 <button class="download-btn" onclick="downloadFile('${escapeHtml(file.name)}')">📥 下载</button>
                                 <button class="delete-btn" onclick="deleteServerFile('${escapeHtml(file.name)}')">🗑️ 删除</button>
                             </div>
                         </div>
                     `;
                 });
                
                html += `<div class="file-count">共 ${files.length} 个文件</div>`;
                serverFilesList.innerHTML = html;
                
            } catch (error) {
                console.error('加载文件列表失败:', error);
                serverFilesList.innerHTML = `
                    <div class="error-message">
                        ❌ 加载文件列表失败<br>
                        <small>${error.message}</small>
                    </div>
                `;
            }
        }

        // HTML转义函数
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // 页面加载完成后的处理（文件列表将在会话创建成功后自动加载）
        document.addEventListener('DOMContentLoaded', function() {
            // 文件列表加载已移至initSession函数中
        });

        // 显示删除确认模态框
         function showDeleteModal(fileName) {
             const modal = document.getElementById('deleteModal');
             const filenameElement = document.getElementById('modalFilename');
             
             filenameElement.textContent = fileName;
             modal.classList.add('show');
             
             // 防止背景滚动
             document.body.style.overflow = 'hidden';
         }
         
         // 隐藏删除确认模态框
         function hideDeleteModal() {
             const modal = document.getElementById('deleteModal');
             modal.classList.remove('show');
             
             // 恢复背景滚动
             document.body.style.overflow = 'auto';
         }
         
         // 删除服务器文件
         async function deleteServerFile(fileName) {
             return new Promise((resolve) => {
                 showDeleteModal(fileName);
                 
                 const modal = document.getElementById('deleteModal');
                 const cancelBtn = document.getElementById('modalCancel');
                 const confirmBtn = document.getElementById('modalConfirm');
                 
                 // 取消删除
                 const handleCancel = () => {
                     hideDeleteModal();
                     cleanup();
                     resolve(false);
                 };
                 
                 // 确认删除
                 const handleConfirm = async () => {
                     try {
                         // 禁用按钮
                         confirmBtn.disabled = true;
                         cancelBtn.disabled = true;
                         confirmBtn.textContent = '删除中...';
                         
                         // 禁用所有删除按钮
                         const deleteButtons = document.querySelectorAll('.delete-btn');
                         deleteButtons.forEach(btn => btn.disabled = true);
                         
                         // 检查会话有效性
            if (!isSessionValid()) {
                handleSessionExpired();
                return;
            }
                         
                         const response = await fetch(`/api/files/${encodeURIComponent(fileName)}?sessionId=${sessionId}`, {
                             method: 'DELETE'
                         });
                         
                         const result = await response.json();
                         
                         if (result.success) {
                             // 删除成功，显示成功消息
                             const statusMessage = document.getElementById('statusMessage');
                             statusMessage.textContent = `文件 "${fileName}" 删除成功！`;
                             statusMessage.className = 'status-message status-success';
                             statusMessage.style.display = 'block';
                             
                             // 刷新文件列表
                             await loadServerFiles();
                             
                             // 3秒后隐藏成功消息
                             setTimeout(() => {
                                 statusMessage.style.display = 'none';
                             }, 3000);
                         } else {
                             throw new Error(result.message || '删除失败');
                         }
                         
                     } catch (error) {
                         console.error('删除文件失败:', error);
                         
                         // 显示错误消息
                         const statusMessage = document.getElementById('statusMessage');
                         statusMessage.textContent = `删除文件失败: ${error.message}`;
                         statusMessage.className = 'status-message status-error';
                         statusMessage.style.display = 'block';
                         
                         // 5秒后隐藏错误消息
                         setTimeout(() => {
                             statusMessage.style.display = 'none';
                         }, 5000);
                     } finally {
                         // 重新启用所有删除按钮
                         const deleteButtons = document.querySelectorAll('.delete-btn');
                         deleteButtons.forEach(btn => btn.disabled = false);
                         
                         hideDeleteModal();
                         cleanup();
                         resolve(true);
                     }
                 };
                 
                 // 清理事件监听器
                 const cleanup = () => {
                     cancelBtn.removeEventListener('click', handleCancel);
                     confirmBtn.removeEventListener('click', handleConfirm);
                     modal.removeEventListener('click', handleModalClick);
                     document.removeEventListener('keydown', handleKeyDown);
                     
                     // 重置按钮状态
                     confirmBtn.disabled = false;
                     cancelBtn.disabled = false;
                     confirmBtn.textContent = '删除';
                 };
                 
                 // 点击模态框背景关闭
                 const handleModalClick = (e) => {
                     if (e.target === modal) {
                         handleCancel();
                     }
                 };
                 
                 // ESC键关闭
                 const handleKeyDown = (e) => {
                     if (e.key === 'Escape') {
                         handleCancel();
                     }
                 };
                 
                 // 添加事件监听器
                 cancelBtn.addEventListener('click', handleCancel);
                 confirmBtn.addEventListener('click', handleConfirm);
                 modal.addEventListener('click', handleModalClick);
                 document.addEventListener('keydown', handleKeyDown);
             });
         }

         // 取消上传功能
         function cancelUpload() {
             if (!isUploading || !uploadAbortController) return;
             
             uploadAbortController.abort();
             
             const statusMessage = document.getElementById('statusMessage');
             statusMessage.textContent = '上传已取消';
             statusMessage.className = 'status-message status-error';
             statusMessage.style.display = 'block';
             
             // 3秒后隐藏消息
             setTimeout(() => {
                 statusMessage.style.display = 'none';
             }, 3000);
         }

         // 修改上传成功后的处理，自动刷新文件列表
         const originalUploadFiles = uploadFiles;
         uploadFiles = async function() {
             await originalUploadFiles();
             // 如果上传成功，刷新文件列表
             const statusMessage = document.getElementById('statusMessage');
             if (statusMessage.classList.contains('status-success')) {
                 setTimeout(() => {
                     loadServerFiles();
                 }, 1000); // 延迟1秒刷新，确保文件已保存
             }
         };

         // 注销功能
         function logout() {
             if (confirm('确定要注销吗？')) {
                 // 清除所有认证相关的本地存储
                 localStorage.removeItem('fileupload_auth_session');
                 localStorage.removeItem('fileupload_auth_time');
                 localStorage.removeItem('fileupload_authenticated'); // 清理旧的认证标记
                 sessionStorage.clear();
                 
                 // 清理会话信息
                 sessionId = null;
                 if (sessionTimer) {
                     clearTimeout(sessionTimer);
                     sessionTimer = null;
                 }
                 
                 console.log('用户已注销，清理完成');
                 
                 // 跳转到首页
                 window.location.href = 'index.html';
             }
         }

         // 文件下载功能 - 支持分片下载
         async function downloadFile(fileName) {
             try {
                 // 禁用下载按钮，防止重复点击
                 const downloadButtons = document.querySelectorAll('.download-btn');
                 downloadButtons.forEach(btn => btn.disabled = true);
                 
                 // 显示下载状态
                 const statusMessage = document.getElementById('statusMessage');
                 statusMessage.textContent = `正在下载文件: ${fileName}`;
                 statusMessage.className = 'status-message status-info';
                 statusMessage.style.display = 'block';
                 
                 // 检查会话有效性
                 if (!isSessionValid()) {
                     handleSessionExpired();
                     return;
                 }
                 
                 // 创建下载链接
                 const downloadUrl = `/api/files/${encodeURIComponent(fileName)}/download?sessionId=${sessionId}`;
                 
                 // 获取文件大小
                 const headResponse = await fetch(downloadUrl, {
                     method: 'HEAD'
                 });
                 
                 if (!headResponse.ok) {
                     throw new Error(`文件下载失败: ${headResponse.status} ${headResponse.statusText}`);
                 }
                 
                 const fileSize = parseInt(headResponse.headers.get('Content-Length') || '0');
                 const chunkSize = 1024 * 1024; // 1MB 分片大小
                 
                 // 如果文件小于分片大小，直接下载
                 if (fileSize <= chunkSize) {
                     await downloadFileDirectly(downloadUrl, fileName);
                 } else {
                     // 分片下载
                     await downloadFileInChunks(downloadUrl, fileName, fileSize, chunkSize);
                 }
                 
                 // 显示成功消息
                 statusMessage.textContent = `文件下载完成: ${fileName}`;
                 statusMessage.className = 'status-message status-success';
                 
                 // 3秒后隐藏消息
                 setTimeout(() => {
                     statusMessage.style.display = 'none';
                 }, 3000);
                 
             } catch (error) {
                 console.error('下载文件失败:', error);
                 
                 // 显示错误消息
                 const statusMessage = document.getElementById('statusMessage');
                 statusMessage.textContent = `下载文件失败: ${error.message}`;
                 statusMessage.className = 'status-message status-error';
                 statusMessage.style.display = 'block';
                 
                 // 5秒后隐藏错误消息
                 setTimeout(() => {
                     statusMessage.style.display = 'none';
                 }, 5000);
             } finally {
                 // 重新启用所有下载按钮
                 const downloadButtons = document.querySelectorAll('.download-btn');
                 downloadButtons.forEach(btn => btn.disabled = false);
             }
         }
         
         // 直接下载小文件
         async function downloadFileDirectly(downloadUrl, fileName) {
             const response = await fetch(downloadUrl);
             if (!response.ok) {
                 throw new Error(`下载失败: ${response.status} ${response.statusText}`);
             }
             
             const blob = await response.blob();
             const url = window.URL.createObjectURL(blob);
             
             const link = document.createElement('a');
             link.href = url;
             link.download = fileName;
             link.style.display = 'none';
             document.body.appendChild(link);
             link.click();
             document.body.removeChild(link);
             
             window.URL.revokeObjectURL(url);
         }
         
         // 分片下载大文件
         async function downloadFileInChunks(downloadUrl, fileName, fileSize, chunkSize) {
             const chunks = [];
             let downloadedBytes = 0;
             
             // 计算分片数量
             const totalChunks = Math.ceil(fileSize / chunkSize);
             
             for (let i = 0; i < totalChunks; i++) {
                 const start = i * chunkSize;
                 const end = Math.min(start + chunkSize - 1, fileSize - 1);
                 
                 // 更新下载进度
                 const statusMessage = document.getElementById('statusMessage');
                 const progress = Math.round((i / totalChunks) * 100);
                 statusMessage.textContent = `正在下载文件: ${fileName} (${progress}% - 分片 ${i + 1}/${totalChunks})`;
                 
                 // 发送Range请求
                 const response = await fetch(downloadUrl, {
                     headers: {
                         'Range': `bytes=${start}-${end}`
                     }
                 });
                 
                 if (!response.ok && response.status !== 206) {
                     throw new Error(`分片下载失败: ${response.status} ${response.statusText}`);
                 }
                 
                 const chunk = await response.arrayBuffer();
                 chunks.push(chunk);
                 downloadedBytes += chunk.byteLength;
                 
                 // 检查会话有效性
                 if (!isSessionValid()) {
                     handleSessionExpired();
                     return;
                 }
             }
             
             // 合并所有分片
             const statusMessage = document.getElementById('statusMessage');
             statusMessage.textContent = `正在合并文件: ${fileName}`;
             
             const blob = new Blob(chunks);
             const url = window.URL.createObjectURL(blob);
             
             const link = document.createElement('a');
             link.href = url;
             link.download = fileName;
             link.style.display = 'none';
             document.body.appendChild(link);
             link.click();
             document.body.removeChild(link);
             
             window.URL.revokeObjectURL(url);
         }

         // 部署功能
         async function startDeploy() {
             const sourceDir = document.getElementById('sourceDir').value.trim();
             const frontendPattern = document.getElementById('frontendPattern').value.trim();
             const backendPattern = document.getElementById('backendPattern').value.trim();
             const deployScript = document.getElementById('deployScript').value.trim();
             const deployBtn = document.getElementById('deployBtn');
             const deployOutput = document.getElementById('deployOutput');
             
             if (!sourceDir || !frontendPattern || !backendPattern || !deployScript) {
                 alert('请填写所有必需的字段');
                 return;
             }
             
             // 禁用按钮，显示执行状态
             deployBtn.disabled = true;
             deployBtn.textContent = '🔄 部署中...';
             
             // 显示输出区域
             deployOutput.classList.add('show');
             deployOutput.textContent = `开始部署流程...\n源目录: ${sourceDir}\n匹配前端文件名: ${frontendPattern}\n匹配后端文件名: ${backendPattern}\n部署脚本: ${deployScript}\n\n`;
             
             try {
                 // 第一步：搜索文件
                 appendDeployLog('🔍 正在搜索匹配的文件...');
                 
                 // 检查会话有效性
                     if (!isSessionValid()) {
                         handleSessionExpired();
                         return;
                     }
                 
                 const searchResponse = await fetch('/api/deploy/search-files', {
                     method: 'POST',
                     headers: {
                         'Content-Type': 'application/json'
                     },
                     body: JSON.stringify({
                         sourceDir: sourceDir,
                         frontendPattern: frontendPattern,
                         backendPattern: backendPattern,
                         sessionId: sessionId
                     })
                 });
                 
                 const searchResult = await searchResponse.json();
                 
                 if (!searchResult.success) {
                     // 检查是否是会话过期错误
                     if (searchResult.error && searchResult.error.includes('会话')) {
                         handleSessionExpired();
                         return;
                     }
                     throw new Error(searchResult.error || '文件搜索失败');
                 }
                 
                 // 显示搜索消息
                 if (searchResult.messages && searchResult.messages.length > 0) {
                     appendDeployLog('🔍 文件搜索结果:');
                     searchResult.messages.forEach(message => {
                         appendDeployLog(`   ${message}`);
                     });
                 }
                 
                 if (!searchResult.files || searchResult.files.length === 0) {
                     throw new Error('未找到可部署的文件');
                 }
                 
                 appendDeployLog(`\n✅ 准备部署 ${searchResult.files.length} 个文件:`);
                 searchResult.files.forEach(file => {
                     const fileName = file.split('\\').pop() || file.split('/').pop();
                     appendDeployLog(`   - ${fileName}`);
                 });
                 
                 // 第二步：上传文件
                 appendDeployLog('\n📤 开始上传文件...');
                 
                 for (const filePath of searchResult.files) {
                     appendDeployLog(`正在上传: ${filePath}`);
                     
                     // 检查会话有效性
                     if (!isSessionValid()) {
                         handleSessionExpired();
                         return;
                     }
                     
                     const uploadResponse = await fetch('/api/deploy/upload-file', {
                         method: 'POST',
                         headers: {
                             'Content-Type': 'application/json'
                         },
                         body: JSON.stringify({
                             filePath: filePath,
                             sessionId: sessionId
                         })
                     });
                     
                     const uploadResult = await uploadResponse.json();
                     
                     if (!uploadResult.success) {
                         throw new Error(`上传文件失败: ${uploadResult.error}`);
                     }
                     
                     appendDeployLog(`✅ 上传成功: ${uploadResult.fileName}`);
                 }
                 
                 // 第三步：执行部署脚本
                 appendDeployLog('\n🚀 开始执行部署脚本...');
                 
                 // 检查会话有效性
                     if (!isSessionValid()) {
                         handleSessionExpired();
                         return;
                     }
                 
                 const scriptResponse = await fetch('/api/execute-script', {
                     method: 'POST',
                     headers: {
                         'Content-Type': 'application/json'
                     },
                     body: JSON.stringify({ 
                         command: deployScript,
                         sessionId: sessionId 
                     })
                 });
                 
                 const scriptResult = await scriptResponse.json();
                 
                 if (scriptResult.success) {
                     appendDeployLog('✅ 部署脚本执行成功！');
                     if (scriptResult.output) {
                         appendDeployLog('脚本输出:');
                         appendDeployLog(scriptResult.output);
                     }
                 } else {
                     appendDeployLog('❌ 部署脚本执行失败！');
                     appendDeployLog(`错误信息: ${scriptResult.error}`);
                 }
                 
                 appendDeployLog('\n🎉 部署流程完成！');
                 
                 // 刷新服务器文件列表
                 setTimeout(() => {
                     loadServerFiles();
                 }, 1000);
                 
             } catch (error) {
                 console.error('部署失败:', error);
                 appendDeployLog(`\n❌ 部署失败: ${error.message}`);
             } finally {
                 // 恢复按钮状态
                 deployBtn.disabled = false;
                 deployBtn.textContent = '🚀 开始部署';
                 
                 // 滚动到输出区域底部
                 deployOutput.scrollTop = deployOutput.scrollHeight;
             }
         }
         
         // 添加部署日志
         function appendDeployLog(message) {
             const deployOutput = document.getElementById('deployOutput');
             const timestamp = new Date().toLocaleTimeString();
             deployOutput.textContent += `[${timestamp}] ${message}\n`;
             deployOutput.scrollTop = deployOutput.scrollHeight;
         }
         
         // 清空部署输出
         function clearDeployOutput() {
             const deployOutput = document.getElementById('deployOutput');
             deployOutput.textContent = '';
             deployOutput.classList.remove('show');
         }

         // ==================== 菜单管理功能 ====================
         
         let menuConfigs = JSON.parse(localStorage.getItem('menuConfigs') || '[]');
         let editingMenuId = null;
         
         // 切换页面section
         function showSection(sectionName) {
             // 隐藏所有section
             const sections = document.querySelectorAll('.content-section');
             sections.forEach(section => {
                 section.classList.remove('active');
             });
             
             // 显示目标section
             const targetSection = document.getElementById(sectionName + '-section');
             if (targetSection) {
                 targetSection.classList.add('active');
             }
             
             // 更新导航按钮状态
             const navBtns = document.querySelectorAll('.nav-btn');
             navBtns.forEach(btn => {
                 btn.classList.remove('active');
             });
             
             // 激活当前按钮
             const activeBtn = document.querySelector(`[onclick="showSection('${sectionName}')"]`);
             if (activeBtn) {
                 activeBtn.classList.add('active');
             }
             
             // 如果切换到菜单管理，加载菜单列表
             if (sectionName === 'menu-config') {
                 loadMenuList();
             }
             
             // 如果切换到自动部署，加载快捷菜单按钮
             if (sectionName === 'deploy') {
                 loadQuickMenuButtons();
             }
         }
         
         // 显示添加菜单表单
         function showAddMenuForm() {
             editingMenuId = null;
             clearMenuForm();
             const form = document.getElementById('menuForm');
             form.classList.remove('hide');
             form.classList.add('show');
         }
         
         // 隐藏菜单表单
         function hideMenuForm() {
             const form = document.getElementById('menuForm');
             form.classList.remove('show');
             form.classList.add('hide');
             editingMenuId = null;
             clearMenuForm();
         }
         
         // 清空菜单表单
         function clearMenuForm() {
             document.getElementById('menuName').value = '';
             document.getElementById('menuSourceDir').value = '';
             document.getElementById('menuFrontendPattern').value = '';
             document.getElementById('menuBackendPattern').value = '';
             document.getElementById('menuDeployScript').value = '';
         }
         
         // 保存菜单
         function saveMenu() {
             const name = document.getElementById('menuName').value.trim();
             const sourceDir = document.getElementById('menuSourceDir').value.trim();
             const frontendPattern = document.getElementById('menuFrontendPattern').value.trim();
             const backendPattern = document.getElementById('menuBackendPattern').value.trim();
             const deployScript = document.getElementById('menuDeployScript').value.trim();
             
             if (!name || !sourceDir || !frontendPattern || !backendPattern || !deployScript) {
                 alert('请填写所有必填字段');
                 return;
             }
             
             const menuConfig = {
                 id: editingMenuId || Date.now().toString(),
                 name: name,
                 sourceDir: sourceDir,
                 frontendPattern: frontendPattern,
                 backendPattern: backendPattern,
                 deployScript: deployScript,
                 createTime: editingMenuId ? menuConfigs.find(m => m.id === editingMenuId).createTime : new Date().toISOString()
             };
             
             if (editingMenuId) {
                 // 编辑现有菜单
                 const index = menuConfigs.findIndex(m => m.id === editingMenuId);
                 if (index !== -1) {
                     menuConfigs[index] = menuConfig;
                 }
             } else {
                 // 添加新菜单
                 menuConfigs.push(menuConfig);
             }
             
             // 保存到localStorage
             localStorage.setItem('menuConfigs', JSON.stringify(menuConfigs));
             
             // 隐藏表单并刷新列表
             hideMenuForm();
             loadMenuList();
             
             // 刷新快捷菜单按钮
             loadQuickMenuButtons();
             
             alert(editingMenuId ? '菜单更新成功！' : '菜单添加成功！');
         }
         
         // 编辑菜单
         function editMenu(menuId) {
             const menu = menuConfigs.find(m => m.id === menuId);
             if (!menu) return;
             
             editingMenuId = menuId;
             document.getElementById('menuName').value = menu.name;
             document.getElementById('menuSourceDir').value = menu.sourceDir;
             document.getElementById('menuFrontendPattern').value = menu.frontendPattern || '';
             document.getElementById('menuBackendPattern').value = menu.backendPattern || '';
             document.getElementById('menuDeployScript').value = menu.deployScript;
             
             const form = document.getElementById('menuForm');
             form.classList.remove('hide');
             form.classList.add('show');
         }
         
         // 删除菜单
         function deleteMenu(menuId) {
             const menu = menuConfigs.find(m => m.id === menuId);
             if (!menu) return;
             
             if (confirm(`确定要删除菜单 "${menu.name}" 吗？`)) {
                 menuConfigs = menuConfigs.filter(m => m.id !== menuId);
                 localStorage.setItem('menuConfigs', JSON.stringify(menuConfigs));
                 loadMenuList();
                 
                 // 刷新快捷菜单按钮
                 loadQuickMenuButtons();
                 
                 alert('菜单删除成功！');
             }
         }
         
         // 执行菜单部署
         async function executeMenuDeploy(menuId) {
             const menu = menuConfigs.find(m => m.id === menuId);
             if (!menu) return;
             
             // 切换到部署页面
             showSection('deploy');
             
             // 填充部署表单
             document.getElementById('sourceDir').value = menu.sourceDir;
             document.getElementById('frontendPattern').value = menu.frontendPattern || '';
             document.getElementById('backendPattern').value = menu.backendPattern || '';
             document.getElementById('deployScript').value = menu.deployScript;
             
             // 自动开始部署
             setTimeout(() => {
                 startDeploy();
             }, 500);
         }
         
         // 加载菜单列表
         function loadMenuList() {
             const menuList = document.getElementById('menuList');
             
             if (menuConfigs.length === 0) {
                 menuList.innerHTML = `
                     <div style="text-align: center; padding: 40px; color: #6b7280;">
                         <div style="font-size: 48px; margin-bottom: 16px;">📋</div>
                         <div style="font-size: 16px; font-weight: 600;">暂无菜单配置</div>
                         <div style="font-size: 14px; margin-top: 8px;">点击上方"添加菜单"按钮创建第一个菜单</div>
                     </div>
                 `;
                 return;
             }
             
             menuList.innerHTML = menuConfigs.map(menu => `
                 <div class="menu-item">
                     <div class="menu-item-header">
                         <div class="menu-item-name">🚀 ${menu.name}</div>
                         <div class="menu-item-actions">
                             <button class="deploy-menu-btn" onclick="executeMenuDeploy('${menu.id}')">部署</button>
                             <button class="edit-btn" onclick="editMenu('${menu.id}')">编辑</button>
                             <button class="delete-btn" onclick="deleteMenu('${menu.id}')">删除</button>
                         </div>
                     </div>
                     <div class="menu-item-details">
                         <div class="menu-detail-item">
                             <div class="menu-detail-label">源目录</div>
                             <div class="menu-detail-value">${menu.sourceDir}</div>
                         </div>
                         <div class="menu-detail-item">
                             <div class="menu-detail-label">匹配前端文件名</div>
                             <div class="menu-detail-value">${menu.frontendPattern || '未设置'}</div>
                         </div>
                         <div class="menu-detail-item">
                             <div class="menu-detail-label">匹配后端文件名</div>
                             <div class="menu-detail-value">${menu.backendPattern || '未设置'}</div>
                         </div>
                         <div class="menu-detail-item">
                             <div class="menu-detail-label">部署脚本</div>
                             <div class="menu-detail-value">${menu.deployScript}</div>
                         </div>
                         <div class="menu-detail-item">
                             <div class="menu-detail-label">创建时间</div>
                             <div class="menu-detail-value">${new Date(menu.createTime).toLocaleString()}</div>
                         </div>
                     </div>
                 </div>
             `).join('');
         }
         
         // ==================== 快捷菜单按钮功能 ====================
         
         // 加载快捷菜单按钮
         function loadQuickMenuButtons() {
             const quickMenuButtons = document.getElementById('quickMenuButtons');
             const quickMenuSection = document.getElementById('quickMenuSection');
             
             if (menuConfigs.length === 0) {
                 quickMenuButtons.innerHTML = `
                     <div class="quick-menu-empty">
                         <div class="quick-menu-empty-icon">📋</div>
                         <div>暂无快捷菜单</div>
                         <div style="margin-top: 8px; font-size: 12px;">请先在菜单管理中配置部署菜单</div>
                     </div>
                 `;
                 return;
             }
             
             quickMenuButtons.innerHTML = menuConfigs.map(menu => `
                 <button class="quick-deploy-btn" onclick="executeQuickDeploy('${menu.id}')" title="${menu.name}\n源目录: ${menu.sourceDir}\n前端文件: ${menu.frontendPattern || '未设置'}\n后端文件: ${menu.backendPattern || '未设置'}\n脚本: ${menu.deployScript}">
                     🚀 ${menu.name}
                 </button>
             `).join('');
         }
         
         // 执行快捷部署
         function executeQuickDeploy(menuId) {
             const menu = menuConfigs.find(m => m.id === menuId);
             if (!menu) {
                 alert('菜单配置不存在');
                 return;
             }
             
             // 填充部署表单
             document.getElementById('sourceDir').value = menu.sourceDir;
             document.getElementById('frontendPattern').value = menu.frontendPattern || '';
             document.getElementById('backendPattern').value = menu.backendPattern || '';
             document.getElementById('deployScript').value = menu.deployScript;
             
             // 滚动到部署区域
             const deployContent = document.querySelector('.deploy-content');
             deployContent.scrollIntoView({ behavior: 'smooth' });
             
             // 自动开始部署
             setTimeout(() => {
                 startDeploy();
             }, 500);
         }
         
         // 页面加载完成后初始化
         document.addEventListener('DOMContentLoaded', function() {
             // 默认显示文件上传页面
             showSection('upload');
             
             // 初始化快捷菜单按钮
             loadQuickMenuButtons();
         });

    </script>
</body>
</html>